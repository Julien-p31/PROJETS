# Tutoriel : Construire un sandbox dâ€™analyse malware sÃ©curisÃ©

## ğŸ¯ Objectif  
CrÃ©er un environnement isolÃ© (virtualisÃ© ou conteneurisÃ©) pour exÃ©cuter des malwares en sÃ©curitÃ©, analyser leur comportement, collecter des indicateurs et rapporter des IOCs exploitables.

## ğŸ§  ScÃ©nario dâ€™ancrage Ã©motionnel  
Vous recevez une piÃ¨ce jointe suspecte d'un client. Vous devez l'exÃ©cuter sans infecter vos systÃ¨mes, comprendre son comportement et enrichir vos dÃ©fenses.

---

## ğŸ› ï¸ PrÃ©requis  
- HÃ´te Linux (Ubuntu/Debian)  
- Virtualisation : VirtualBox/VMware ou Docker/Kasm  
- Outils : **Cuckoo Sandbox** (ou CAPE), agents invitÃ©s, Wireshark, Procmon, Sysmon  
- python, pip, git, `sudo`

---

## ğŸ§© Ã‰tape 1 â€“ Choisir votre stratÃ©gie

- **VMs isolÃ©es** (ex. Windows/Linux) : sÃ©paration complÃ¨te du host   
- **Conteneurs** (Docker/Kubernetes) : plus lÃ©gers, mais attention Ã  l'isolement   
- **Cloud interactif** (ANY.RUN) : rapide, mais moins contrÃ´lable 

---

## ğŸ§© Ã‰tape 2 â€“ Architecture du sandbox

- **Host** : orchestrateur Cuckoo  
- **Worker machines** : VMs isolÃ©es exÃ©cutant les malwares, connectÃ©es via rÃ©seau cloisonnÃ©  
- **Stockage** : rÃ©sultats, PCAPs, screenshots 

---

## ğŸ”§ Ã‰tape 3 â€“ Installation et configuration de Cuckoo

```bash
sudo apt update
pip install cuckoo vmcloak
sudo useradd -m cuckoo
su - cuckoo
virtualenv ~/cuckoo-env && source ~/cuckoo-env/bin/activate
pip install cuckoo vmcloak
cuckoo machine --add win7
vmcloak-base image, snapshot
cuckoo config
cuckoo community --update
cuckoo start

	â€¢	Installez lâ€™agent Cuckoo sur VM et prenez un snapshot
	â€¢	Configurez host-only network pour cloisonner les VMs et Ã©viter les fuites de donnÃ©es

â¸»

ğŸ§© Ã‰tape 4 â€“ ExÃ©cution de lâ€™analyse
	1.	Soumettez un sample :

cuckoo submit /chemin/vers/malware.exe


	2.	Cuckoo dÃ©marre la VM, exÃ©cute le sample, collecte logs, captures rÃ©seaux et screenshots
	3.	Un rapport JSON, PCAP, rapports API/process/fichiers est gÃ©nÃ©rÃ©

â¸»

ğŸ” Ã‰tape 5 â€“ Collecte & enrichissement
	â€¢	RÃ©cupÃ©rez IOCs : fichiers crÃ©Ã©s, clÃ©s registre, IP externes
	â€¢	Visualisez le trafic PCAP avec Wireshark
	â€¢	IntÃ©grez les IOCs dans votre SIEM ou MISP
	â€¢	Exportez les rapports (JSON, HTML) pour documentation

â¸»

ğŸ§  Ã‰tape 6 â€“ DÃ©tection dâ€™Ã©vasions & anti-sandbox
	â€¢	Simulez prÃ©sence humaine (movements/mouse, macros Word)
	â€¢	Modifiez les snapshots pour Ã©viter reconnaissance dâ€™environnement virtuel
	â€¢	Analysez les rapports pour Ã©checs ou erreurs dâ€™exÃ©cution

â¸»

ğŸ§ª Quiz de consolidation
	1.	Pourquoi utiliser un snapshot VM ?
	2.	Quelle isolation faut-il pour prÃ©venir les fuites rÃ©seau ?
	3.	Que collecte Cuckoo lors de lâ€™exÃ©cution ?
	4.	Comment dÃ©jouer les dÃ©tections anti-sandbox ?
	5.	OÃ¹ intÃ©grer les IOCs obtenus ?

â¸»

âœ… Cas dâ€™usage concret
	â€¢	Analyse dâ€™un exÃ©cutable Windows suspect
	â€¢	Extraction dâ€™indicateurs pour enrichissement SIEM ou firewall
	â€¢	Plateforme de dÃ©tection centralisÃ©e pour lâ€™Ã©quipe SOC

â¸»

ğŸ”§ Extensions possibles
	â€¢	Ajouter CAPE pour analyses modernes (support Pythonâ€¯3)
	â€¢	IntÃ©grer Elastic Stack pour collecte et visualisation en temps rÃ©el
	â€¢	Automatiser avec scripts pour dÃ©ploiement cloud (Terraform/Ansible + Guacamole)

â¸»

ğŸ“ RÃ©sultat attendu
	â€¢	Sandbox opÃ©rationnel avec au moins 1 VM isolÃ©e
	â€¢	Soumission et exÃ©cution de samples
	â€¢	Rapports exploitables : IOCs, traces rÃ©seau, changements systÃ¨me
	â€¢	Processus reproductible, sÃ©curisÃ© et nettoyable

---

### ğŸ“š Sources principales  
- Tutoriel "How to Build a Custom Malware Analysis Sandbox"   
- Documentation officielle Cuckoo Sandbox   
- Guides retours dâ€™expÃ©rience (Elastic, ANY.RUN, Hatching)   
- Archi visuelle de sandbox/VM isolÃ©es   
