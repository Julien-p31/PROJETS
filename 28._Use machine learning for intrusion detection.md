# Tutoriel : Utiliser le Machine Learning pour la dÃ©tection dâ€™intrusion (IDS)

## ğŸ¯ Objectif  
Construire un IDS basÃ© sur ML, capable de dÃ©tecter en temps rÃ©el des comportements rÃ©seau malveillants ou anormaux grÃ¢ce Ã  des modÃ¨les supervisÃ©s et non supervisÃ©s.

## ğŸ§  ScÃ©nario dâ€™ancrage  
Suite Ã  une sÃ©rie de scans suspects sur votre serveur, vous devez crÃ©er un IDS ML pour identifier automatiquement attaques DoS, scans, bruteâ€‘force ou exfiltration, amÃ©liorer votre posture sÃ©curitÃ©.

---

## ğŸ› ï¸ PrÃ©requis  
- Linux (Ubuntu/Debian/Kali)  
- Python 3.8+, `pip`  
- Scapy (capturer trafic), Pandas, scikitâ€‘learn, Streamlit pour prototype UI

```bash
sudo apt update
sudo apt install python3-pip
pip install scapy pandas scikit-learn streamlit joblib


â¸»

ğŸ§© Ã‰tapeâ€¯1 â€“ Collecte & prÃ©paration des donnÃ©es
	1.	Capturer du trafic rÃ©seau (ex. pcap) ou utiliser jeu dâ€™exemple comme NSLâ€‘KDD/KDDâ€‘99.
	2.	Charger les donnÃ©es, encoder les catÃ©gories, normaliser :

import pandas as pd
from sklearn.preprocessing import LabelEncoder, StandardScaler

df = pd.read_csv("nsl_kdd_train.csv")
cat = ["protocol_type","service","flag"]
for c in cat:
    df[c] = LabelEncoder().fit_transform(df[c])
X, y = df.drop("label",1), LabelEncoder().fit_transform(df["label"])
X = StandardScaler().fit_transform(X)


â¸»

ğŸ§© Ã‰tapeâ€¯2 â€“ SÃ©lection du modÃ¨le & entraÃ®nement

Utilisez un modÃ¨le supervisÃ© (ex. RandomForest) :

from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)
clf = RandomForestClassifier(n_estimators=100)
clf.fit(X_train, y_train)
print(classification_report(y_test, clf.predict(X_test)))

âœ… Les RandomForest donnent souvent de bons rÃ©sultats sur ce type de donnÃ©es.  ï¿¼ ï¿¼ ï¿¼

â¸»

ğŸ§© Ã‰tapeâ€¯3 â€“ DÃ©tection non supervisÃ©e (anomalies)

Pour dÃ©tecter des attaques zÃ©roâ€‘day, utilisez Isolation Forest :

from sklearn.ensemble import IsolationForest

iso = IsolationForest(contamination=0.02)
y_pred = iso.fit_predict(X)
anoms = (y_pred == -1)

ğŸ“Œ Ce modÃ¨le ne nÃ©cessite pas de labels dâ€™attaque.  ï¿¼

â¸»

ğŸ§© Ã‰tapeâ€¯4 â€“ Prototype de dÃ©tection en temps rÃ©el

import scapy.all as sc
import joblib, numpy as np

clf = joblib.load("rf_model.pkl")  # entraÃ®nÃ© prÃ©cÃ©demment
def process(pkt):
    feat = extract_features(pkt)  # Ã  dÃ©finir : durÃ©es, ports, flags, tailles
    y = clf.predict(feat.reshape(1,-1))
    if y != 0:
        print("âš ï¸ Intrusion dÃ©tectÃ©e :", y)
sc.sniff(iface="eth0", prn=process, store=False)


â¸»

ğŸ”§ Ã‰tapeâ€¯5 â€“ CrÃ©ation de dashboard avec Streamlit

# dashboard.py
import streamlit as st
st.title("IDS ML")
if st.button("Lancer dÃ©tection"):
    import realtime_detect as rd
    rd.start()

Lancez avec :

streamlit run dashboard.py


â¸»

ğŸ§  Ã‰tapeâ€¯6 â€“ Ã‰valuation & tuning
	â€¢	Utilisez crossâ€‘validation, gridâ€‘search ou Optuna
	â€¢	Analysez prÃ©cision, rappel, F1, matrice de confusion
	â€¢	ExpÃ©rimentez dâ€™autres modÃ¨les : SVM, XGBoost, rÃ©seaux neuronaux  ï¿¼ ï¿¼ ï¿¼

â¸»

ğŸ§© Ã‰tapeâ€¯7 â€“ DÃ©ploiement & production
	â€¢	Emballez le modÃ¨le (pickle/joblib)
	â€¢	IntÃ©grez-le dans un service (Flask, microservice)
	â€¢	Ingest logs/alerte dans un SIEM
	â€¢	Combinez signature IDS (Suricata/Snort) + ML pour meilleure couverture  ï¿¼

â¸»

ğŸ§ª Quiz de consolidation
	1.	Pourquoi combiner modÃ¨les supervisÃ©s et non supervisÃ©s ?
	2.	Quâ€™est-ce que le jeu NSLâ€‘KDD ?
	3.	Quel indicateur donne le score F1 ?
	4.	Pourquoi utiliser Isolation Forest pour les attaques inconnues ?
	5.	Comment rÃ©duire les faux positifs en production ?

â¸»

âœ… Cas dâ€™usage spÃ©cifiques
	â€¢	Analyse offline de logs rÃ©seau
	â€¢	DÃ©tection temps rÃ©el sur appliance Python
	â€¢	Plateforme de dÃ©tection enrichie (alerte Slack/SIEM)

â¸»

ğŸ”§ Extensions possibles
	â€¢	Ajouter ExplicabilitÃ© (SHAP) pour dÃ©chiffrer dÃ©cisions modÃ¨le  ï¿¼ ï¿¼ ï¿¼ ï¿¼ ï¿¼
	â€¢	Utiliser des techniques Deep Learning (LSTM, CNN) sur sÃ©ries temporelles ()
	â€¢	EntraÃ®ner sur des datasets modernes (CIC-IDS2018/2017)  ï¿¼

â¸»

ğŸ“ RÃ©sultat attendu
	â€¢	ModÃ¨le ML performant pour classer le trafic
	â€¢	Prototype de dÃ©tection temps rÃ©el fonctionnel
	â€¢	Dashboard simple pour visualiser les alertes
	â€¢	Base solide pour un IDS hybride production-ready

Sourcesâ€¯:
- Implementation MLâ€‘IDS (RandomForest, SVMâ€¦) sur NSLâ€‘KDD/NSLâ€‘KDD datasets  [oai_citation:14â€¡Learn with Yasir](https://yasirbhutta.github.io/python/docs/projects/python-project4.html?utm_source=chatgpt.com) [oai_citation:15â€¡GitHub](https://github.com/jaydugad/Intrusion-Detection-System-using-Deep-Learning?utm_source=chatgpt.com)  
- Anomaly detection & Isolation Forest pour IDS  [oai_citation:16â€¡GitHub](https://github.com/Mthize/Network-Intrusion-Detection-System-NIDS-?utm_source=chatgpt.com)  
- Ã‰tudes dâ€™Ã©valuation comparatives des algorithmes IDSâ€ML  [oai_citation:17â€¡arXiv](https://arxiv.org/abs/2203.05232?utm_source=chatgpt.com)