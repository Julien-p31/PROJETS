# Tutoriel : Construire un outil pour dÃ©tecter les activitÃ©s inhabituelles

## ğŸ¯ Objectif  
CrÃ©er un outil Python capable de surveiller le trafic rÃ©seau ou les logs systÃ¨me, dÃ©tecter en temps rÃ©el les activitÃ©s anormales via des mÃ©thodes statistiques ou machine learning, et gÃ©nÃ©rer des alertes exploitables.

## ğŸ§  ScÃ©nario dâ€™ancrage  
Vous Ãªtes analyste SOC et vous remarquez un pic inattendu de connexions sortantes. Vous devez crÃ©er un outil autonome pour dÃ©tecter et signaler ces anomalies avant quâ€™un incident rÃ©el nâ€™arrive.

---

## ğŸ› ï¸ PrÃ©requis  
- Linux (Ubuntu/Debian)  
- Python 3.8+  
- DÃ©pendances :
  ```bash
  pip install scapy pandas scikit-learn pyod matplotlib

	â€¢	Wifi/Ethernet en mode promiscuitÃ© (network sniffing)

â¸»

Ã‰tapeâ€¯1 â€“ Capturer le trafic ou les logs

A. Pour le trafic rÃ©seau :

from scapy.all import sniff
def capture(packet):
    pkt_summary = (packet.src, packet.dst, packet.proto)
    # stocker dans un DataFrame ou compte

B. Pour les logs systÃ¨me :

import os, time
def tail(f, callback):
    f.seek(0,2)
    while True:
        line = f.readline()
        if not line:
            time.sleep(0.1)
            continue
        callback(line)

Vous pouvez enrichir les donnÃ©es (timestamp, ports, tailles, codes de rÃ©ponseâ€¦).

â¸»

ğŸ§© Ã‰tapeâ€¯2 â€“ Traitement & extraction des caractÃ©ristiques

Collectez les mÃ©triques utiles par intervalle (10â€¯s, 1â€¯min) :

import pandas as pd
df = pd.DataFrame(records)  # columns: src, dst, count, bytes, duration

Exemple de caractÃ©ristiques :
	â€¢	nombre total de paquets/connexions
	â€¢	distribution des IPs/ports
	â€¢	volumes moyens/aritÃ©

Ratio, moyennes mobiles, flux binÃ©sâ€¦

â¸»

ğŸ§© Ã‰tapeâ€¯3 â€“ DÃ©tection dâ€™anomalies

Utiliser Isolation Forest (un modÃ¨le non supervisÃ© trÃ¨s efficace)  ï¿¼ ï¿¼ ï¿¼ :

from sklearn.ensemble import IsolationForest
clf = IsolationForest(contamination=0.01)
clf.fit(df_train)
df['anomaly'] = clf.predict(df)  # -1 = anomalie

Pour logs, vous pouvez aussi utiliser PyOD (bibliothÃ¨que dÃ©diÃ©e Ã  lâ€™anomaly detection)  ï¿¼.

â¸»

ğŸ§© Ã‰tapeâ€¯4 â€“ CrÃ©ation de lâ€™outil CLI

import argparse
parser = argparse.ArgumentParser()
parser.add_argument("--iface", help="Interface Ã  surveiller")
parser.add_argument("--logfile", help="Fichier de logs", default=None)
args = parser.parse_args()

# capture (trafic ou logs) -> fill records
# build df + features (fenÃªtre 1 min)
# assign anomaly = model.predict()
# si anomalie -> print/Ã©crire alert + dÃ©tails


â¸»

ğŸ§  Ã‰tapeâ€¯5 â€“ Visualiser les alertes

Ajouter une visualisation simple :

import matplotlib.pyplot as plt
plt.plot(df['timestamp'], df['anomaly'])
plt.show()

Ou gÃ©nÃ©rer un diagramme plus avancÃ© (flux normal vs anormal).

â¸»

ğŸ§© Ã‰tapeâ€¯6 â€“ ScÃ©narios dâ€™usage
	â€¢	Pic inhabituel de connexions : bruteforce, scan ou DDoS
	â€¢	Spike en exfiltration : volume anormal de donnÃ©es sortantes
	â€¢	Logs systÃ¨me suspects : echec massif dâ€™authentifications, permissions Ã©levÃ©es

â¸»

ğŸ§  PiÃ¨ges & conseils
	â€¢	Bien calibrer contamination pour Ã©viter les faux positifs
	â€¢	VÃ©rifier la stabilitÃ© des features (ex. volume varie selon lâ€™heure ou la charge)
	â€¢	Remettre Ã  jour et rÃ©entraÃ®ner le modÃ¨le rÃ©guliÃ¨rement

â¸»

ğŸ§ª Quiz de consolidation
	1.	Pourquoi utiliser Isolation Forestâ€¯?
	2.	Que signifie contamination=0.01â€¯?
	3.	Pourquoi regrouper les donnÃ©es par intervalle (fenÃªtre)â€¯?
	4.	Comment rÃ©duire les faux positifs en productionâ€¯?
	5.	Quelle visualisation peut aider Ã  comprendre les anomaliesâ€¯?

â¸»

âœ… Ã‰tapes ultÃ©rieures
	â€¢	ğŸ” Automatiser la capture & dÃ©tection via un service systemd
	â€¢	ğŸ“¤ Envoi dâ€™alertes : email, webhook Slack ou API SIEM
	â€¢	ğŸ“Š DÃ©ploiement dâ€™un tableau de bord avec Flask ou Streamlit (logâ€¯+ anomalies)
	â€¢	Inspirez-vous de ce projet Flask + Isolation Forest  ï¿¼ ï¿¼ ï¿¼
	â€¢	ğŸ” Passer Ã  de lâ€™analyse sÃ©quentielle sur logs avec Transformers  ï¿¼

â¸»

ğŸ“ RÃ©sultat attendu
	â€¢	Un script rÃ©utilisableâ€¯: surveillance trafic/logs â†’ dÃ©tection anomalies â†’ alertes
	â€¢	Visualisation claire des incidents (via console ou graphique)
	â€¢	Base solide pour dÃ©ploiement en contexte professionnel

â¸»

ğŸ“š Sources utiles
	â€¢	DÃ©tection anomalies rÃ©seau Python + Scapy + Isolation Forest  ï¿¼
	â€¢	DÃ©tection anomalies sur logs avec PyOD et Transformers  ï¿¼
	â€¢	RÃ©alisations existantes (rÃ©seau, streaming, dashboard) ()

