# Tutoriel : ArrÃªter les attaques en mÃ©moire (fileless & inâ€‘memory attacks)

## ğŸ¯ Objectif  
Comprendre les attaques en mÃ©moire â€“ processus dâ€™injection, fileless, phishing via PowerShell â€“ et dÃ©ployer des dÃ©fenses solides (EDR, dÃ©tection comportementale, hardening) pour dÃ©tecter et bloquer les attaques en temps rÃ©el.

## ğŸ§  ScÃ©nario dâ€™ancrage  
Un attaquant lance un exploit via PowerShell dans un processus lÃ©gitime, injecte un shellcode fileless et commence lâ€™exfiltration. Pas de fichier malveillant, tout opÃ¨re en RAM : comment le dÃ©tecter et lâ€™arrÃªterâ€¯?

---

## ğŸ› ï¸ PrÃ©requis  
- Linux ou Windows  
- Environnement PowerShell (Windows), paquets Python facultatifs  
- Outilsâ€¯: EDR/NGAV (ex. CrowdStrike, Todyl), script PowerShell *Getâ€‘InjectedThreads* (Elastic), radare2 pour reverse minimal  
- AccÃ¨s admin pour logs/processus

---

## ğŸ§© Ã‰tapeâ€¯1 â€“ Comprendre les attaques en mÃ©moire  
- **DÃ©finition**â€¯: malware opÃ¨re uniquement en RAM, sans rÃ©siduel sur disque, injecte des threads dans des processus fiables (explorer, svchost)  [oai_citation:0â€¡todyl.com](https://www.todyl.com/blog/defending-against-in-memory-attacks-with-endpoint-security-and-memory-threat-protection?utm_source=chatgpt.com) [oai_citation:1â€¡sasa-software.com](https://www.sasa-software.com/learning/in-memory-malware/?utm_source=chatgpt.com)  
- **Techniques courantes** : reflective DLL injection, process hollowing, PowerShell chargement de script base64  [oai_citation:2â€¡LinkedIn](https://www.linkedin.com/pulse/memory-based-attacks-rise-fileless-malware-how-defend-anoushka-das-scire?utm_source=chatgpt.com)  
- **Challenge** : les antivirus traditionnels ne voient rien â†’ ces attaques dÃ©jouent DEP/ASLR et la signature  [oai_citation:3â€¡arXiv](https://arxiv.org/abs/1009.1038?utm_source=chatgpt.com)

---

## ğŸ§© Ã‰tapeâ€¯2 â€“ DÃ©tection comportementale & outils EDR

1. Activez une solution avec **Memory Threat Protection / Advanced Memory Scanning** (ex. Todyl, CrowdStrike)  
   - Surveille lâ€™exÃ©cution de code en RAM, injection de threads, anomalies de sÃ©quences  [oai_citation:4â€¡todyl.com](https://www.todyl.com/blog/defending-against-in-memory-attacks-with-endpoint-security-and-memory-threat-protection?utm_source=chatgpt.com) [oai_citation:5â€¡Wikipedia](https://en.wikipedia.org/wiki/Buffer_overflow?utm_source=chatgpt.com)  
2. DÃ©ployez script *Getâ€‘InjectedThreads* (PowerShell)  
   ```powershell
   Install-Module -Name GetInjectedThreads
   Get-InjectedThreads | Format-List ProcessName, ThreadStartAddress

	â€¢	DÃ©tecte des threads dont lâ€™adresse de dÃ©part est hors espace image (-PE)  ï¿¼

	3.	Analysez les comportements atypiques : Excel â†’ PowerShell, cmdLoad, process injecting into others (report EDR comme IOAs)  ï¿¼

â¸»

ğŸ§© Ã‰tapeâ€¯3 â€“ Bloquer lâ€™injection via hardening OS
	â€¢	Activez DEP (Data Execution Prevention) + ASLR pour rendre lâ€™injection et shellcode plus difficiles  ï¿¼
	â€¢	ImplÃ©mentez LSA/credential guard sur Windows, IOMMU/VTD sur Linux/UEFI pour protÃ©ger la mÃ©moire physique contre accÃ¨s direct (DMA)  ï¿¼
	â€¢	Lock-down les macro PowerShell : restreindre lâ€™usage et whitelister les scripts connus ()

â¸»

ğŸ›ï¸ Ã‰tapeâ€¯4 â€“ Analyse post-dÃ©tection & rÃ©ponse
	â€¢	Une fois une injection dÃ©tectÃ©e :
	â€¢	Dump de la mÃ©moire du processus via EDR / WinDbg
	â€¢	Analyser la sÃ©quence dâ€™injection, fonctions replicating code  ï¿¼ ï¿¼
	â€¢	Utilisez un sandbox mÃ©moire : Qiling, Volatility pour extraire le shellcode ()
	â€¢	SIEM : corrÃ©lez injection + trafic suspect + comportements anormaux (exfiltration via DNS/HTTP) ()

â¸»

ğŸ”„ Ã‰tapeâ€¯5 â€“ Automatisation & rÃ©ponse couleur bleu
	1.	Configurez alertes automatiques sur injection dÃ©tectÃ©e
	2.	Processus : contenir (isoler host), bloquer le processus, snapshot collect, purge mÃ©moire
	3.	Forensics sur le dump + scripts Powershell injectÃ©s, domain-flags, IOC
	4.	Playbook pour corriger le vecteur originel (patch, rod)

â¸»

ğŸ§  Ã‰tapeâ€¯6 â€“ Mesures prÃ©ventives & durabilitÃ©
	â€¢	Appliquez principle of least privilege (arrÃªter PowerShell sur station non-admin)
	â€¢	Auditez rÃ©guliÃ¨rement les autorisations systÃ¨mes
	â€¢	RÃ©-entraÃ®nez EDR sur nouveaux patterns (machine learning)  ï¿¼
	â€¢	Maintenez OS & applications bien patchÃ©es (exposition via CVE mÃ©moire)  ï¿¼

â¸»

ğŸ§ª Quiz de consolidation
	1.	Pourquoi les attaques en mÃ©moire Ã©chappent-elles aux antivirus ?
	2.	Comment Getâ€‘InjectedThreads identifie-t-il une injection ?
	3.	Quel rÃ´le jouent DEP & ASLR dans la dÃ©fense ?
	4.	Que faut-il faire immÃ©diatement aprÃ¨s dÃ©tection dâ€™injection ?
	5.	Pourquoi restreindre les scripts PowerShell ?

â¸»

âœ… Cas dâ€™usage
	â€¢	SOC : dÃ©tection dâ€™un PowerShell obfusquÃ© injectÃ© par phishing
	â€¢	IR : host isolÃ© en direct suite Ã  alerte â€œthread non-imageâ€
	â€¢	Tests rouge contre bleu : injection simulÃ©es pour mesurer MTTD

â¸»

ğŸ”§ Extensions possibles
	â€¢	IntÃ©grer IOC IoC memory dans SIEM analyste humain + EDR
	â€¢	Analyser shellcode via sandbox mÃ©moire (Qiling, Volatility)
	â€¢	Ajouter capteurs hardware perf counters pour anomalies bas-niveau  ï¿¼ ï¿¼ ï¿¼
	â€¢	Automatiser dump + analyse via scripts PowerShell

â¸»

ğŸ“ RÃ©sultat attendu
	â€¢	Infrastructure capable de dÃ©tecter et prÃ©venir en temps rÃ©el les injections en mÃ©moire
	â€¢	RÃ©ponse SOC rapide â€“ isolation host et collecte forensic
	â€¢	Couche comportementale plus robuste que signature statique

---

### ğŸ“š Principales sources  
- DÃ©tection mÃ©moire avec EDR & Machine Learning (Todyl, CrowdStrike)  [oai_citation:17â€¡todyl.com](https://www.todyl.com/blog/defending-against-in-memory-attacks-with-endpoint-security-and-memory-threat-protection?utm_source=chatgpt.com)  
- Script *Getâ€‘InjectedThreads* pour trouver des threads suspects  [oai_citation:18â€¡Elastic](https://www.elastic.co/security-labs/hunting-memory?utm_source=chatgpt.com)  
- Techniques & dÃ©fis des attaques en mÃ©moire et fileless  [oai_citation:19â€¡Cyber Security News](https://cybersecuritynews.com/memory-based-attacks/?utm_source=chatgpt.com)  
- Hardening (DEP/ASLR/PowerShell lockdown/IOMMU)  [oai_citation:20â€¡Wikipedia](https://en.wikipedia.org/wiki/Address_space_layout_randomization?utm_source=chatgpt.com)  
- Analyse mÃ©moire en sandbox et dump forensic  [oai_citation:21â€¡Elastic](https://www.elastic.co/security-labs/hunting-memory?utm_source=chatgpt.com)