# Tutoriel : Construire une PKI (Publicâ€¯Keyâ€¯Infrastructure) privÃ©e sÃ©curisÃ©e

## ğŸ¯ Objectif  
Monter une PKI hiÃ©rarchique simple avec Root CA offline, Intermediate CA online, gestion de certificats (serveurs et clients), et validation (CRL/OCSP).

## ğŸ§  ScÃ©nario dâ€™ancrage Ã©motionnel  
Vous Ãªtes responsable sÃ©curitÃ© pour une entreprise. Vous devez Ã©tablir une confiance interne via des certificats pour VPN, serveurs web internes, signatures de code, sans dÃ©pendre dâ€™autoritÃ©s externes.

---

## ğŸ› ï¸ PrÃ©requis  
- Linux (Ubuntu/Debian)  
- `openssl` installÃ©  
- Optionnelâ€¯: Easyâ€‘RSA ou OpenXPKI pour faciliter  
- RÃ©seau interne (VPN, intranet)

---

## ğŸ§© Ã‰tapeâ€¯1 â€“ Concepts et architecture

- CA root (offline) signe les Intermediate CAs (tierâ€‘2)   
- Intermediate CA gÃ¨re les certificats utilisateurs et serveurs  
- Publication de certificats & CRL/OCSP via serveur web simple ou OpenSSL  
- Les clients reÃ§oivent certificat + chemin CA pour validation (pathâ€‘validation) 

---

## ğŸ§© Ã‰tapeâ€¯2 â€“ CrÃ©er la Root CA avec OpenSSL

```bash
openssl genrsa -aes256 -out rootCA.key 4096
openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 3650 \
  -out rootCA.pem -subj "/C=FR/O=MonEntreprise/OU=RootCA/CN=MonRootCA"

Stockez rootCA.key hors ligne â€” point central de confiance de votre PKI.

â¸»

ğŸ§© Ã‰tapeâ€¯3 â€“ Intermediate CA

openssl genrsa -out intermediate.key 4096
openssl req -new -key intermediate.key -out intermediate.csr \
  -subj "/C=FR/O=MonEntreprise/OU=IntermediateCA/CN=MonIntermediateCA"
openssl x509 -req -in intermediate.csr -CA rootCA.pem -CAkey rootCA.key \
  -CAcreateserial -out intermediate.pem -days 1825 -sha256

â†’ intermediate.pem sert pour signer les certificats clients/serveurs.

â¸»

ğŸ§© Ã‰tapeâ€¯4 â€“ Signer un certificat serveur
	1.	CrÃ©ez configuration OpenSSL server.cnf avec SAN.
	2.	Gen private key & CSR :

openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr -config server.cnf


	3.	Signez avec Intermediate CA :

openssl x509 -req -in server.csr -CA intermediate.pem -CAkey intermediate.key \
 -CAcreateserial -out server.crt -days 825 -sha256 -extensions v3_req \
 -extfile server.cnf


	4.	DÃ©ployez server.crt + server.key sur votre service HTTPS.

â¸»

ğŸ§© Ã‰tapeâ€¯5 â€“ GÃ©nÃ©ration dâ€™une CRL (revocation list)

CrÃ©ez une CRL pour gÃ©rer les certificats rÃ©voquÃ©s :

openssl ca -config openssl.cnf -keyfile intermediate.key -cert intermediate.pem \
  -gencrl -out intermediate.crl

Publiez .crl via HTTP; les clients/le serveur OCSP peuvent vÃ©rifier la rÃ©vocation.

â¸»

ğŸ§© Ã‰tapeâ€¯6 â€“ OCSP pour validation en temps rÃ©el
	1.	CrÃ©ez certificate pour OCSP responder.
	2.	DÃ©ployez un serveur OCSP (ex. openssl ocsp).
	3.	Configurez clients pour consulter lâ€™OCSP afin dâ€™Ã©viter lâ€™usage de certificats rÃ©voquÃ©s.

â¸»

ğŸ” Ã‰tapeâ€¯7 â€“ Validation de chemin (path validation)

Cliente utilise les certificats Root + Intermediate + serveur :
	1.	Charge server.crt
	2.	Monte la chaÃ®ne jusquâ€™au Root
	3.	VÃ©rifie chacune des signatures et dates
	4.	Consulter CRL ou OCSP pour statut rÃ©vocation
â†’ Valider la confiance et lâ€™intÃ©gritÃ©

â¸»

ğŸ”§ Ã‰tapeâ€¯8 â€“ Automatiser avec script ou Easyâ€‘RSA

Avec Easyâ€‘RSA :

git clone https://github.com/OpenVPN/easy-rsa.git
./easyrsa init-pki
./easyrsa build-ca nopass
./easyrsa gen-req server nopass
./easyrsa sign-req server server
./easyrsa gen-crl

Permet de standardiser le workflow (initialisation, demande, signature, rÃ©vocation)

â¸»

ğŸ§  Bonnes pratiques & piÃ¨ges
	â€¢	ProtÃ©ger la clÃ© Rootâ€¯: conserver offline dans HSM ou coffre ({CITATION?})
	â€¢	ProtÃ©ger Intermediate online mais verrouiller les accÃ¨s
	â€¢	RÃ¨gles de nommage (CN, SAN, usage, expiration) limpides
	â€¢	Planifier rÃ©vocation et renouvellement (rotation)
	â€¢	Limiter la validitÃ© (1â€¯an pour serveurs, 3â€¯ans max)

â¸»

ğŸ§ª Quiz de consolidation
	1.	Pourquoi une Root CA doit-elle rester offline ?
	2.	Ã€ quoi sert un Intermediate CA ?
	3.	Quelle diffÃ©rence entre CRL et OCSP ?
	4.	Pourquoi signer un certificat serveur ?
	5.	Comment le client vÃ©rifieâ€‘tâ€‘il quâ€™un certificat nâ€™est pas rÃ©voquÃ© ?

â¸»

âœ… Cas dâ€™usage
	â€¢	VPN interne (OpenVPN/IPsec)
	â€¢	Intranet HTTPS/LDAP sÃ©curisÃ©
	â€¢	Signature de code ou email via S/MIME

â¸»

ğŸ”§ Extensions possibles
	â€¢	Mettre en place serveur PKI complet (EJBCA, OpenXPKI)
	â€¢	IntÃ©grer ACME (Smallstep, CFSSL) pour automatiser le renouvellement
	â€¢	Ajouter audit, journaux, HSM, Key Ceremony (rotation contrÃ´lÃ©e)

â¸»

ğŸ“ RÃ©sultat attendu
	â€¢	Root CA offline + Intermediate CA opÃ©rationnelle
	â€¢	Certificats serveur et clients signÃ©s, monitorÃ©s, rÃ©voquÃ©s
	â€¢	Infrastructure PKI maÃ®trisÃ©e, Ã©volutive, sÃ©curisÃ©e

---

### ğŸ“š RÃ©fÃ©rences principales  
- OpenSSL PKI tutoriel + construction CA intermÃ©diaire   
- Concepts PKI (CA, RA, CRL, OCSP, validation de chaÃ®ne)   
- Automatisation via Easyâ€‘RSA   
- Mise Ã  lâ€™Ã©chelle avec EJBCA et ACME (Smallstep, Cloudflare) 
