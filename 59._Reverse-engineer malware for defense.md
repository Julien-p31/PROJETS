# Tutoriel : Reverse‑engineer du malware pour renforcer votre défense

## 🎯 Objectif  
Déconstruire un malware pour comprendre son fonctionnement (packing, injection, C2, persistence) et en tirer des signatures & règles de détection efficaces (YARA, IOC, IPS).

## 🧠 Scénario d’ancrage émotionnel  
Un SOC détecte un binaire inconnu sur un serveur. En le reverse‑engineerant, vous révélez sa logique malveillante (download/run modules, injection mémoire, C2), extrayez des indicateurs et protégez le reste de l’infrastructure.

---

## 🛠️ Prérequis  
- VM/Linux ou Windows isolée (snapshot avant chaque analyse)  [oai_citation:0‡Intezer](https://intezer.com/blog/incident-response/malware-reverse-engineering-for-beginners-part-2/?utm_source=chatgpt.com) [oai_citation:1‡LinkedIn](https://www.linkedin.com/pulse/reverse-engineering-malware-syed-ashfaque-ali?utm_source=chatgpt.com) [oai_citation:2‡Huntress](https://www.huntress.com/blog/understanding-evil-how-to-reverse-engineer-malware?utm_source=chatgpt.com)  
- Outils :
  - **Disassembleurs/Décompilateurs** : *Ghidra* (v11.3+), *radare2*  [oai_citation:3‡WebAsha](https://www.webasha.com/blog/what-are-the-best-free-malware-analysis-tools-for-reverse-engineering-and-threat-detection?utm_source=chatgpt.com)  
  - **Débuggers** : *x64dbg* / *OllyDbg* (Windows), *GDB*  
  - **Sandboxes** : *Cuckoo*, *ANY.RUN*  [oai_citation:4‡Varonis](https://www.varonis.com/blog/how-to-use-ghidra?utm_source=chatgpt.com) [oai_citation:5‡WebAsha](https://www.webasha.com/blog/what-are-the-best-free-malware-analysis-tools-for-reverse-engineering-and-threat-detection?utm_source=chatgpt.com)  
  - **Outils annexes** : *PEStudio*, *Detect It Easy*, *YARA*, *Procmon*, *Wireshark*

---

## 🧩 Étape 1 – Acquisition & environnement sécurisé  
1. Téléchargez le sample malware dans VM isolée.  [oai_citation:6‡Intezer](https://intezer.com/blog/incident-response/malware-reverse-engineering-for-beginners-part-2/?utm_source=chatgpt.com) [oai_citation:7‡YouTube](https://www.youtube.com/watch?v=GerVtd7-kLQ&utm_source=chatgpt.com)  
2. Prenez un snapshot « clean state ».  
3. Bloquez les interfaces réseau, ou utilisez sandbox contrôlée. ()

---

## 🧩 Étape 2 – Analyse statique préliminaire  
1. Utilisez *PEStudio*/*DIE* pour inspecter le PE (imports, sections, strings).  
2. Recherchez si le fichier est packé (sections “UPX” ou forte entropie >7). Utilisez *radare2*.  [oai_citation:8‡Intezer](https://intezer.com/blog/incident-response/malware-reverse-engineering-for-beginners-part-2/?utm_source=chatgpt.com)  
3. Si packé avec UPX, exécutez :
   ```bash
   upx -d sample.exe -o unpacked.exe

puis ré-analysez. ()

⸻

🧩 Étape 3 – Reverse avec Ghidra
	1.	Importez unpacked.exe dans Ghidra.
	2.	Lancez l’analyse automatique.
	3.	Examinez les fonctions clés : WinExec, CreateProcess, WriteFile, LoadLibrary.
	4.	Relevez chaînes de configuration, adresses C2, noms de fichiers/persistence.

⸻

🧩 Étape 4 – Analyse dynamique
	1.	Déboguez le binaire dans x64dbg ou OllyDbg.  ￼ ￼
	2.	Placez des breakpoints sur fonctions critiques.
	3.	Tracez l’exécution et observez comportement : injection, loader, création services.

⸻

🧩 Étape 5 – Sandbox & traffic réseau
	1.	Exécutez dans Cuckoo ou ANY.RUN. Capturez trafic réseau, fichiers créés, mutexes.  ￼ ￼ ￼
	2.	Analysez logs Procmon, Wireshark pour détecter IOCs (domaines, chemins, mutex, process tree).

⸻

🧩 Étape 6 – Génération de règles de défense
	•	Créez signatures YARA :

rule SuspiciousLoader {
  strings:
    $cmd = "powershell -nop -w hidden" wide ascii
    $url = "http://malicious.com/loader.exe"
  condition:
    any of them
}


	•	Intégrez IOCs dans l’IPS/SIEM : nom mutex, dossier %APPDATA%\svchost.exe, domaine C2.

⸻

🧠 Étape 7 – Validation et déploiement
	1.	Testez vos YARA/règles dans un lab avec des samples propres.
	2.	Simulez un autre sample pour vérifier la robustesse.
	3.	Menez une chasse proactive dans les logs pour rechercher IOCs.

⸻

🧪 Quiz de consolidation
	1.	Pourquoi unpacker un PE packé avant reverse ?
	2.	Quels indicateurs réseau surveiller après sandbox ?
	3.	Que révèle le débogage d’un loader ?
	4.	Quelle est l’utilité des règles YARA ?
	5.	Pourquoi tester vos règles avec des samples non malveillants ?

⸻

✅ Cas d’usage
	•	Réponse IR/Forensic : comprendre un incident et durcir les défenses.
	•	Threat intelligence : enrichir CTI avec patterns binaires, domaines, chaînes.
	•	Antivirus/EDR : ajout de détections comportementales sur loader/injection.

⸻

🔧 Extensions possibles
	•	Automatiser le pipeline (sandbox → disassembly → YARA generation).
	•	Intégrer Pharos ou Phantom (pattern matching avancé)  ￼ ￼ ￼ ￼
	•	Suivre des ateliers type SANS FOR610  ￼

⸻

🎓 Résultat attendu
	•	Compréhension fine de la logique du malware
	•	Production de signatures solides et traçables
	•	Déploiement sur production avec validation
	•	Capacité à détecter et bloquer d’autres variantes

---

### 📚 Sources  
- Étapes de reverse & setup safe lab (EC‑Council, Huntress)  [oai_citation:19‡Huntress](https://www.huntress.com/blog/understanding-evil-how-to-reverse-engineer-malware?utm_source=chatgpt.com)  
- Outils gratuits 2025 : Ghidra, radare2, Cuckoo, ANY.RUN  [oai_citation:20‡WebAsha](https://www.webasha.com/blog/what-are-the-best-free-malware-analysis-tools-for-reverse-engineering-and-threat-detection?utm_source=chatgpt.com)  
- Détection de packers UPX avec entropie & section names  [oai_citation:21‡Intezer](https://intezer.com/blog/incident-response/malware-reverse-engineering-for-beginners-part-2/?utm_source=chatgpt.com)  
- Cours SANS FOR610 & pattern matching SEI Pharos  [oai_citation:22‡insights.sei.cmu.edu](https://insights.sei.cmu.edu/reverse-engineering-for-malware-analysis/?utm_source=chatgpt.com)  
- Outils de debugging : OllyDbg, x64dbg, IDA | top outils RE 2025  [oai_citation:23‡Cybersapiens](https://cybersapiens.com.au/top-10-reverse-engineering-tools-used-by-ethical-hackers/?utm_source=chatgpt.com)